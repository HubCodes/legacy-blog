---
layout: post
tags: test
comments: true
---

문득 내가 ICMP에 대해 들어만 봤을 뿐 아는 건 없다는 사실을 깨달았다. 그래서 네트워크 책을 참고해서 정리했다.

1. ICMP는 IP를 보조하기 위한 프로토콜이다.
2. ICMP도 IP처럼 v4와 v6이 있다.
3. ICMP는 IP 패킷과 관련하여 발생하는 상황들을 파악하고 핸들링하는 데 도움을 줄 수 있는 프로토콜이다.
4. ICMP는 꼭 필요한 상황에만 생성되고, 생성되지 않을 수도 있으며, 수신 호스트가 ICMP 메시지를 수신했다고 하더라도 아무 일도 하지 않을 수 있다.
5. ICMP 메시지는 여러 종류를 가지고 있다. 크게 보면 오류 메시지와 정보 제공 메시지로 나뉜다.
   1. 목적지 접근 불가 (에러)
   2. 송신 속도 낮춤 (에러)
   3. 리다이렉트 (에러)
   4. 시간 초과 (에러)
   5. 에코 요청/응답 (정보)
   6. 라우터 광고/정보 요청 (정보)
   7. 타임스탬프 요청/응답 (정보)
6. ICMP 에러 메시지는 다음 상황에서는 생성하지 않도록 정해져 있다.
   1. ICMP 에러 메시지에 대한 에러 메시지
   2. 브로드캐스트/멀티캐스트에 대한 에러 메시지
   3. IP 데이터그램에서 두 번째 이후의 프래그먼트에 대한 에러 메시지
   4. 유니캐스트 주소가 아닌 출발지 주소로부터 발생한 에러에 대한 메시지
7. ICMP 에러 메시지는 원본 데이터그램 일부를 포함할 수 있다.

### 목적지 접근 불가

목적지에 접근할 수 없는 상황은 여러 가지로 나눌 수 있다. 아래는 그 중 일부이다.

- 네트워크 접근 불가 (IP 주소가 잘못되었거나/라우팅 과정에 문제가 생겼거나)
- 호스트 접근 불가 (네트워크까지는 전달됐지만 호스트에 도달하지 못함. 보통 라우팅 문제)
- 프로토콜 접근 불가 (Protocol 필드에 명시된 프로토콜이 상대 호스트가 받아들일 수 없는 종류의 것임)
- 포트 접근 불가 (UDP/TCP 포트가 유효하지 않음)
- 프래그먼테이션이 필요하지만 DF (Don't fragment) 가 세트되어 있음 (MTU 크기보다 큰 메시지를 보내려고 함)
- 소스 라우팅 실패 (미리 정해진 라우팅 경로로 라우팅할 수 없음)
- 알려지지 않은 목적지 호스트 (목적지 호스트와 같은 네트워크 상의 라우터에 의해 생성됨. 주소가 잘못된 상황)

### 송신 속도 낮춤

수신 측의 네트워크 버퍼가 가득 찼거나, 남은 공간이 부족한 경우 수신 측이 혼잡한 상황이라고 말할 수 있다. 이러한 상황에서 수신자는 송신자에게 자신이 더 이상 새로운 메시지를 수용하기 힘든 상황임을 알릴 수단이 송신 속도 낮춤 메시지이다.

하지만 송신 속도 낮춤 메시지는 지극히 단순하다. 혼잡 제어라는 의도는 좋지만, 만약 송신 측에서 이 메시지를 받고 송신 속도를 낮췄다면, 언제 다시 송신 속도를 늘릴 수 있는지 어떻게 결정할까? 천천히 송신하는 양을 늘려가는 수 뿐일 것이다. 마찬가지로 수신 측에서는 언제 이 메시지를 만들어야 할까? 버퍼가 가득찬 다음에? 아니면 가득 찰 것 같을 때? 또한 만약 네트워크의 중간에 악의적인 사용자가 이 메시지를 남용하면?

때문에 별로 사용되지 않는다고 한다. 대신 좀 더 좋은 방법으로 전송 계층의 TCP가 제공하는 혼잡 제어 알고리즘들이 있다.

### 시간 초과

IP에는 TTL이 존재하고 각 홉마다 하나씩 줄어든다. 만약 TTL이 0이 되면 해당 데이터그램은 버려진다. 이때 해당 데이터그램을 버린 라우터에서는 송신 측에 이를 어떻게 알릴까? 시간 초과 메시지는 이러한 상황에서 사용된다. 이 메시지를 받은 송신 측에서는 지나치게 작은 TTL을 설정했다는 사실을 알게 된다. 그것이 아니라면 다른 라우팅 경로를 선택할 수도 있다.

{% include disqus_comments.html %}
